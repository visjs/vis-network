<html>
  <head>
    <meta charset="utf-8" />
    <title>Vis Network | Other | Saving and Loading Networks</title>
  </head>
  <body>
    <form
      id="form"
      action="https://codepen.io/pen/define"
      method="post"
      target="_self"
    >
      <input
        type="hidden"
        name="data"
        value='{"css":"body {\n  font: 10pt sans;\n}\n#mynetwork {\n  float: left;\n  width: 600px;\n  height: 600px;\n  margin: 5px;\n  border: 1px solid lightgray;\n}\n#config {\n  float: left;\n  width: 400px;\n  height: 600px;\n}\n#input_output {\n  height: 10%;\n  width: 15%;\n}\n\np {\n  font-size: 16px;\n  max-width: 700px;\n}\n","css_external":"","html":"<p>\n  In this example, the network data can be exported to JSON and imported back\n  into the network. Try this out by exporting the network to JSON, clearing the\n  network and then importing it again. The nodes will all appear in the same\n  position as they were before the network was destroyed.\n</p>\n\n<div id=\"mynetwork\"></div>\n\n<div>\n  <textarea id=\"input_output\"></textarea>\n  <input\n    type=\"button\"\n    id=\"import_button\"\n    onclick=\"importNetwork()\"\n    value=\"import\"\n  />\n  <input\n    type=\"button\"\n    id=\"export_button\"\n    onclick=\"exportNetwork()\"\n    value=\"export\"\n  />\n  <input\n    type=\"button\"\n    id=\"destroy_button\"\n    onclick=\"destroyNetwork()\"\n    value=\"destroy\"\n  />\n</div>\n","js":"import { generateRandomNodesAndEdges } from \"../exampleUtil.js\";\n\nvar container;\nvar exportArea;\nvar importButton;\nvar exportButton;\n\nfunction init() {\n  container = document.getElementById(\"mynetwork\");\n  exportArea = document.getElementById(\"input_output\");\n  importButton = document.getElementById(\"import_button\");\n  exportButton = document.getElementById(\"export_button\");\n\n  draw();\n}\n\nfunction addConnections(elem, index) {\n  // need to replace this with a tree of the network, then get child direct children of the element\n  elem.connections = globalThis.network.getConnectedNodes(index);\n}\n\nfunction destroyNetwork() {\n  globalThis.network.destroy();\n}\n\nfunction clearOutputArea() {\n  exportArea.value = \"\";\n}\n\nfunction draw() {\n  // create a network of nodes\n  var data = generateRandomNodesAndEdges(5);\n\n  globalThis.network = new vis.Network(container, data, {\n    manipulation: { enabled: true },\n  });\n\n  clearOutputArea();\n}\n\nfunction exportNetwork() {\n  clearOutputArea();\n\n  var nodes = objectToArray(globalThis.network.getPositions());\n\n  nodes.forEach(addConnections);\n\n  // pretty print node data\n  var exportValue = JSON.stringify(nodes, undefined, 2);\n\n  exportArea.value = exportValue;\n\n  resizeExportArea();\n}\n\nfunction importNetwork() {\n  var inputValue = exportArea.value;\n  var inputData = JSON.parse(inputValue);\n\n  var data = {\n    nodes: getNodeData(inputData),\n    edges: getEdgeData(inputData),\n  };\n\n  globalThis.network = new vis.Network(container, data, {});\n\n  resizeExportArea();\n}\n\nfunction getNodeData(data) {\n  var networkNodes = [];\n\n  data.forEach(function (elem, index, array) {\n    networkNodes.push({\n      id: elem.id,\n      label: elem.id,\n      x: elem.x,\n      y: elem.y,\n    });\n  });\n\n  return new vis.DataSet(networkNodes);\n}\n\nfunction getNodeById(data, id) {\n  for (var n = 0; n < data.length; n++) {\n    if (data[n].id == id) {\n      // double equals since id can be numeric or string\n      return data[n];\n    }\n  }\n\n  throw \"Can not find id &apos;\" + id + \"&apos; in data\";\n}\n\nfunction getEdgeData(data) {\n  var networkEdges = [];\n\n  data.forEach(function (node) {\n    // add the connection\n    node.connections.forEach(function (connId, cIndex, conns) {\n      networkEdges.push({ from: node.id, to: connId });\n      let cNode = getNodeById(data, connId);\n\n      var elementConnections = cNode.connections;\n\n      // remove the connection from the other node to prevent duplicate connections\n      var duplicateIndex = elementConnections.findIndex(function (connection) {\n        return connection == node.id; // double equals since id can be numeric or string\n      });\n\n      if (duplicateIndex != -1) {\n        elementConnections.splice(duplicateIndex, 1);\n      }\n    });\n  });\n\n  return new vis.DataSet(networkEdges);\n}\n\nfunction objectToArray(obj) {\n  return Object.keys(obj).map(function (key) {\n    obj[key].id = key;\n    return obj[key];\n  });\n}\n\nfunction resizeExportArea() {\n  exportArea.style.height = 1 + exportArea.scrollHeight + \"px\";\n}\n\ninit();\n","js_external":"https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js;https://unpkg.com/alea@1.0.0/alea.js","title":"Vis Network | Other | Saving and Loading Networks"}'
      />
      <button id="open" alt="JSFiddle" title="JSFiddle">Open CodePen</button>
    </form>

    <script type="text/javascript">
      document.getElementById("open").click();
    </script>
  </body>
</html>
